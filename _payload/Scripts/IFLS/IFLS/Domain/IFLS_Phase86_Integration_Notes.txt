IFLS – Phase 86: Flavor Propagation Visualization
=================================================

This folder contains a reference implementation for Phase 86 as described
in your progress snapshot:

  ► Phase 86 – "Flavor Propagation Visualization"
    Add indicator in FX Brain showing which flavor is currently active.

CONTENT
-------

1) IFLS_FlavorState.lua
   ---------------------
   Central module for resolving the currently active flavor from:
     - Artist default
     - ArtistHub override
     - ArtistFXChain override

   ExtState keys (adapt as needed at the top of the file):

     Namespace: "IFLS"

     KEY_ARTIST_DEFAULT   = "artist_default_flavor"
     KEY_HUB_OVERRIDE     = "artisthub_flavor_override"
     KEY_CHAIN_OVERRIDE   = "artistfxchain_flavor_override"
     KEY_FINAL_CACHE      = "active_flavor_cache"

   Public API:

     local FlavorState = require("IFLS_FlavorState")

     local state = FlavorState.get_active()
     -- state = {
     --   artist_default = string|nil,
     --   hub_override   = string|nil,
     --   chain_override = string|nil,
     --   final_flavor   = string,  -- resolved flavor (never nil)
     --   source         = "chain_override" | "hub_override" |
     --                    "artist_default" | "default"
     -- }

     FlavorState.set_artist_default(flavor)
     FlavorState.clear_artist_default()

     FlavorState.set_hub_override(flavor)
     FlavorState.clear_hub_override()

     FlavorState.set_chain_override(flavor)
     FlavorState.clear_chain_override()

     FlavorState.debug_dump_to_console()

   Integration points:

   - Artist Profile loader should call `FlavorState.set_artist_default(...)`
     when an artist is selected or loaded.
   - ArtistHub flavor dropdown should call `FlavorState.set_hub_override(...)`
     whenever the user changes the flavor in the UI.
   - ArtistFXChainDomain should call `FlavorState.set_chain_override(...)`
     when a per-chain flavor override is applied.


2) IFLS_FXBrain_FlavorIndicator.lua
   ---------------------------------
   Example ReaImGui window that visualizes the active flavor using the
   FlavorState helper.

   Requirements:
     - ReaImGui extension installed (via ReaPack -> ReaTeam Extensions).
     - IFLS_FlavorState.lua available in ReaScript search path.

   Usage:
     - Import the script into REAPER as a ReaScript and run it to see
       a standalone "IFLS FX Brain - Flavor" window.
     - Or copy the inner UI block (inside `loop()` and between
       `ImGui_Begin/End`) into your existing FX Brain ImGui script.

   Core UI snippet you can paste into your FX Brain panel:

     local state = FlavorState.get_active()
     local flavor = state.final_flavor or "Neutral"
     local source = state.source or "default"

     reaper.ImGui_Text(ctx, "Active Flavor")
     local col = get_flavor_color(flavor)
     reaper.ImGui_PushStyleColor(ctx, reaper.ImGui_Col_Text(), col)
     reaper.ImGui_BulletText(ctx, flavor)
     reaper.ImGui_PopStyleColor(ctx)

     reaper.ImGui_Separator(ctx)
     reaper.ImGui_Text(ctx, "Source: " .. source)

3) HOW TO DROP INTO YOUR REPO
   --------------------------

   A. Files:
      - Copy `IFLS_FlavorState.lua` into your core IFLS Lua module folder.
      - Copy `IFLS_FXBrain_FlavorIndicator.lua` into a "Tools" or "Debug"
        scripts folder (optional, for testing).

   B. ArtistHub integration:
      - In the ArtistHub ImGui script, in the callback that handles
        changes in the Flavor dropdown, add:

          FlavorState.set_hub_override(selected_flavor)

   C. ArtistFXChainDomain integration:
      - Where your chain logic enforces a flavor override, add:

          FlavorState.set_chain_override(chain_flavor)

        and clear it when the override is removed:

          FlavorState.clear_chain_override()

   D. Artist Profile loading:
      - When loading/switching artist profiles, set:

          FlavorState.set_artist_default(artist.flavor)

   E. FX Brain window:
      - In your main FX Brain ImGui script, somewhere prominent
        in the header area, paste the core "Active Flavor" UI block
        so the user can always see the resolved state.

With these pieces, Phase 86 ("Flavor Propagation Visualization") is
implemented in a modular way and can be integrated into your existing
repository without disrupting earlier phases.
